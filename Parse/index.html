<!DOCTYPE html>
<html>
  <head>
  <title>Wi-Find</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <link type="text/css" rel="stylesheet" href="css/styles.css" media="screen" />
    <script type="text/javascript"
      src="http://maps.googleapis.com/maps/api/js?key=AIzaSyBVYmtKrniJdpYFLa4-QMXaWYemedvw1bA&sensor=true">
    </script>
    <script src="http://www.parsecdn.com/js/parse-1.1.5.min.js"></script>
    <script type="text/javascript">
      Parse.initialize("w2QBbAohqDJLi4kE7tMP5oaca09vw63UgCo8OfMv", "EOfmgHdudoXYhuRtdjN7dpEPMg7CqE03YTzBcZRx");
      var Hotspots = Parse.Object.extend("Hotspots");
      // User's location
      if(navigator.geolocation)
      {
        navigator.geolocation.getCurrentPosition(successFunction,errorFunction);
      }
      else{
        alert('Error: No location');
      }
      
      function errorFunction(position)
      {
        alert('No');
        var mapOptions = {
          center: new google.maps.LatLng(42.046389, -87.694722),
          zoom: 14,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(document.getElementById("map_canvas"),
            mapOptions);
        var image = 'images/marker.png';
        var point = new Parse.GeoPoint({latitude: 42.046399, longitude: -87.694752});
        var query = new Parse.Query(Hotspots);
        // Interested in locations near user.
        query.near("Location", point);
        // Limit what could be a lot of points.
        query.limit(10);
        //var query = new Parse.Query(Hotspots);
        //query.equalTo("Name","Joe's Stupid Wifi");
        query.find({
          success: function(results) {
            for (x=0;x<results.length;x++)
            {
              var myLatLng = new google.maps.LatLng(results[x].get("Location").latitude, results[x].get("Location").longitude);
              var evanstonMarker = new google.maps.Marker({
                position: myLatLng,
                map: map,
                icon: image
              });
            }
          },
          error: function(error) {
            alert("Error: " + error.code + " " + error.message);
          }
        });
      }
      
      function successFunction(position)
      {
        var mapOptions = {
          center: new google.maps.LatLng(42.046389, -87.694722),
          zoom: 14,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(document.getElementById("map_canvas"),
            mapOptions);
        var image = 'images/marker.png';
        var lat = position.coords.latitude;
        var long = position.coords.longitude;
        var point = new Parse.GeoPoint({latitude: lat, longitude: long});
        var query = new Parse.Query(Hotspots);
        
        // Interested in locations near user.
        query.near("Location", point);
        
        // Limit what could be a lot of points. Change later to respond to user input.
        query.limit(10);
        query.find({
          success: function(results) {
            for (x=0;x<results.length;x++)
            {
              var myLatLng = new google.maps.LatLng(results[x].get("Location").latitude, results[x].get("Location").longitude);
              var evanstonMarker = new google.maps.Marker({
                position: myLatLng,
                map: map,
                icon: image,
                title:'testPop'
              });
              var infowindow = new google.maps.InfoWindow({
                  content: contentString
              });


              var contentString = "Bandwidth: " + results[x].get("Bandwidth") + ", Name: "+ results[x].get("Name");



              google.maps.event.addListener(evanstonMarker, 'click', function() {
                  infowindow.open(map,evanstonMarker);
              });

            }
          },
          error: function(error) {
            alert("Error: " + error.code + " " + error.message);
          }
        });
      }
      
      function initialize() {
        var mapOptions = {
          center: new google.maps.LatLng(42.046389, -87.694722),
          zoom: 8,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(document.getElementById("map_canvas"),
            mapOptions);
        var image = 'images/marker.png';
        var myLatLng = new google.maps.LatLng(42.046389, -87.694722);
        var evanstonMarker = new google.maps.Marker({
            position: myLatLng,
            map: map,
            icon: image
        });

        
      }

    </script>
  </head>
  <body onload="initialize()">
    <div id="map_canvas" style="width:100%; height:100%"></div>
  </body>
</html>